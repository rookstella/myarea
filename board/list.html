<div class="container" style="max-width:800px; margin:auto; background:#fff; padding:30px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.1); font-family:'Segoe UI', sans-serif;">
  <h1 style="text-align:center; color:#333; margin-bottom:25px;">ğŸ“‹ ê²Œì‹œíŒ ëª©ë¡</h1>
  <div id="postList"></div>

  <!-- ê¸€ì“°ê¸° ë²„íŠ¼ -->
  <div style="text-align:center; margin-top:30px;">
    <button id="goToWrite" style="padding:12px 20px; background:#007bff; color:white; border:none; border-radius:8px; font-weight:bold; cursor:pointer;">âœï¸ ê¸€ ì‘ì„±í•˜ê¸°</button>
  </div>
</div>

<script>
  const loggedInUser = sessionStorage.getItem('loggedInUser');
  const users = JSON.parse(localStorage.getItem('users')) || [];
  const currentUser = users.find(u => u.username === loggedInUser);
  const isAdmin = currentUser?.isAdmin;

  function formatDate(isoString) {
    const date = new Date(isoString);
    return date.toLocaleString('ko-KR', {
      year: 'numeric', month: '2-digit', day: '2-digit',
      hour: '2-digit', minute: '2-digit'
    });
  }

  function loadPosts() {
    const postList = document.getElementById('postList');
    const posts = JSON.parse(localStorage.getItem('posts') || '[]');

    if (posts.length === 0) {
      postList.innerHTML = '<p style="text-align:center; color:#777;">ì‘ì„±ëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
      attachWriteBtnListener();
      return;
    }

    postList.innerHTML = '';

    posts.forEach(post => {
      const wrapper = document.createElement('div');
      wrapper.style.borderBottom = '1px solid #eee';
      wrapper.style.padding = '20px 0';

      wrapper.innerHTML = `
        <h3 class="post-title" style="margin:0; color:#007bff; cursor:pointer;" data-id="${post.id}">
          ${post.title}
        </h3>
        <p style="margin:5px 0 5px; color:#555; font-size:14px;">
          ì‘ì„±ì: <strong>${post.author}</strong> | ì‘ì„±ì¼: ${post.createdAt ? formatDate(post.createdAt) : 'ì•Œ ìˆ˜ ì—†ìŒ'} ${post.updatedAt ? `(ìˆ˜ì •ë¨: ${formatDate(post.updatedAt)})` : ''}
        </p>
        <div class="post-content" style="display:none; margin-bottom:10px; color:#444; line-height:1.6; white-space: pre-wrap;">
          ${post.content}
        </div>
        <div class="post-actions" style="display:none; margin-bottom:10px;">
          ${(loggedInUser === post.author || isAdmin) ? `
            <button class="edit-btn" data-id="${post.id}" style="margin-right:10px; padding:6px 12px; background:#ffc107; color:#333; border:none; border-radius:4px; cursor:pointer;">ìˆ˜ì •</button>
            <button class="delete-btn" data-id="${post.id}" style="padding:6px 12px; background:#dc3545; color:white; border:none; border-radius:4px; cursor:pointer;">ì‚­ì œ</button>
          ` : ''}
        </div>
      `;

      postList.appendChild(wrapper);
    });

    // ì œëª© í´ë¦­ ì‹œ ë‚´ìš© í† ê¸€
    document.querySelectorAll('.post-title').forEach(title => {
      title.addEventListener('click', () => {
        const content = title.parentElement.querySelector('.post-content');
        const actions = title.parentElement.querySelector('.post-actions');
        const isVisible = content.style.display === 'block';
        content.style.display = isVisible ? 'none' : 'block';
        actions.style.display = isVisible ? 'none' : 'block';
      });
    });

    // ì‚­ì œ
    document.querySelectorAll('.delete-btn').forEach(button => {
      button.addEventListener('click', () => {
        if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
        const id = parseInt(button.getAttribute('data-id'));
        let posts = JSON.parse(localStorage.getItem('posts') || '[]');
        posts = posts.filter(p => p.id !== id);
        localStorage.setItem('posts', JSON.stringify(posts));
        alert('ê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        loadPosts();
      });
    });

    // ìˆ˜ì •
    document.querySelectorAll('.edit-btn').forEach(button => {
      button.addEventListener('click', () => {
        const id = parseInt(button.getAttribute('data-id'));
        const posts = JSON.parse(localStorage.getItem('posts') || '[]');
        const post = posts.find(p => p.id === id);
        if (!post) return;
        sessionStorage.setItem('editPost', JSON.stringify(post));
        if (typeof loadPage === 'function') {
          loadPage('board/write.html');
        } else {
          alert('ì‘ì„± í˜ì´ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
      });
    });

    attachWriteBtnListener();
  }

  function attachWriteBtnListener() {
    const goToWriteBtn = document.getElementById('goToWrite');
    if (!goToWriteBtn) return;

    goToWriteBtn.onclick = null;

    goToWriteBtn.addEventListener('click', () => {
      const loggedInUser = sessionStorage.getItem('loggedInUser');
      if (!loggedInUser) {
        alert('ë¡œê·¸ì¸ í›„ ê¸€ ì‘ì„±ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
        if (typeof loadPage === 'function') loadPage('member/login.html');
        else location.href = 'member/login.html';
        return;
      }
      sessionStorage.removeItem('editPost');
      if (typeof loadPage === 'function') loadPage('board/write.html');
      else location.href = 'board/write.html';
    });
  }

  // ì´ˆê¸° ë¡œë“œ
  loadPosts();

</script>













