<div class="container" style="max-width:600px; margin:auto; background:#fff; padding:20px; border-radius:8px; box-shadow:0 2px 10px rgba(0,0,0,0.1);">
  <h2 style="text-align:center; color:#333; margin-bottom:30px;">회원가입</h2>
  
  <form id="signupForm">
    <div style="margin-bottom:15px; display:flex; align-items:center;">
      <label style="width:120px; font-weight:bold; text-align:right; margin-right:15px;">이름:</label>
      <input type="text" id="name" name="name" required style="flex:1; padding:10px; border:1px solid #ddd; border-radius:4px;">
    </div>
    
    <div style="margin-bottom:15px; display:flex; align-items:center;">
      <label style="width:120px; font-weight:bold; text-align:right; margin-right:15px;">아이디:</label>
      <input type="text" id="username" name="username" required style="flex:1; padding:10px; border:1px solid #ddd; border-radius:4px;">
    </div>
    
    <div style="margin-bottom:15px;">
      <div style="display:flex; align-items:center;">
        <label style="width:120px; font-weight:bold; text-align:right; margin-right:15px;">닉네임:</label>
        <div style="display:flex; gap:10px; flex:1;">
          <input type="text" id="nickname" name="nickname" required style="flex:1; padding:10px; border:1px solid #ddd; border-radius:4px;">
          <button type="button" id="checkNickname" style="padding:10px 15px; background:#007bff; color:white; border:none; border-radius:4px; cursor:pointer;">중복체크</button>
        </div>
      </div>
      <div id="nicknameStatus" style="margin-left:135px; margin-top:5px; font-size:12px;"></div>
    </div>
    
    <div style="margin-bottom:15px; display:flex; align-items:center;">
      <label style="width:120px; font-weight:bold; text-align:right; margin-right:15px;">이메일:</label>
      <input type="email" id="email" name="email" required style="flex:1; padding:10px; border:1px solid #ddd; border-radius:4px;">
    </div>
    
    <div style="margin-bottom:15px;">
      <div style="display:flex; align-items:center;">
        <label style="width:120px; font-weight:bold; text-align:right; margin-right:15px;">주민번호:</label>
        <div style="display:flex; align-items:center; gap:5px; flex:1;">
          <input type="text" id="birth6" name="birth6" placeholder="YYMMDD" maxlength="6" required style="width:80px; padding:10px; border:1px solid #ddd; border-radius:4px;">
          <span>-</span>
          <input type="text" id="rrn1" name="rrn1" placeholder="1" maxlength="1" required style="width:40px; padding:10px; border:1px solid #ddd; border-radius:4px;">
          <span style="color:#999;">●●●●●</span>
        </div>
      </div>
      <div style="margin-left:135px; margin-top:5px; font-size:12px; color:#666;">
        <span id="genderDisplay"></span> | <span id="ageDisplay"></span>
      </div>
    </div>
    
    <div style="margin-bottom:15px; display:flex; align-items:center;">
      <label style="width:120px; font-weight:bold; text-align:right; margin-right:15px;">비밀번호:</label>
      <input type="password" id="password" name="password" required style="flex:1; padding:10px; border:1px solid #ddd; border-radius:4px;">
    </div>
    
    <div style="margin-bottom:20px; display:flex; align-items:center;">
      <label style="width:120px; font-weight:bold; text-align:right; margin-right:15px;">비밀번호 확인:</label>
      <input type="password" id="confirmPassword" name="confirmPassword" required style="flex:1; padding:10px; border:1px solid #ddd; border-radius:4px;">
    </div>
    
    <div style="text-align:center;">
      <button type="submit" style="padding:12px 30px; background:#007bff; color:white; border:none; border-radius:4px; cursor:pointer; font-size:16px;">가입하기</button>
    </div>
  </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const signupForm = document.getElementById('signupForm');
  const nicknameInput = document.getElementById('nickname');
  const checkNicknameBtn = document.getElementById('checkNickname');
  const nicknameStatus = document.getElementById('nicknameStatus');
  const birth6Input = document.getElementById('birth6');
  const rrn1Input = document.getElementById('rrn1');
  const genderDisplay = document.getElementById('genderDisplay');
  const ageDisplay = document.getElementById('ageDisplay');
  
  let nicknameChecked = false;
  
  // 닉네임 중복 체크
  checkNicknameBtn.addEventListener('click', function() {
    const nickname = nicknameInput.value.trim();
    if (!nickname) {
      nicknameStatus.textContent = '닉네임을 입력해주세요.';
      nicknameStatus.style.color = '#dc3545';
      nicknameChecked = false;
      return;
    }
    
    const users = JSON.parse(localStorage.getItem('users') || '[]');
    const existingUser = users.find(user => user.nickname === nickname);
    
    if (existingUser) {
      nicknameStatus.textContent = '이미 사용중인 닉네임입니다.';
      nicknameStatus.style.color = '#dc3545';
      nicknameChecked = false;
    } else {
      nicknameStatus.textContent = '사용 가능한 닉네임입니다.';
      nicknameStatus.style.color = '#28a745';
      nicknameChecked = true;
    }
  });
  
  // 주민번호 뒷자리 첫번째 숫자만 1,2 입력 가능
  rrn1Input.addEventListener('input', function() {
    const value = this.value;
    if (value && value !== '1' && value !== '2') {
      this.value = '';
    }
    updateGenderAndAge();
  });
  
  // 생년월일 입력시 성별과 나이 업데이트
  birth6Input.addEventListener('input', updateGenderAndAge);
  
  function updateGenderAndAge() {
    const birth6 = birth6Input.value;
    const rrn1 = rrn1Input.value;
    
    if (birth6.length === 6 && rrn1) {
      // 성별 표시
      const gender = rrn1 === '1' ? '남성' : '여성';
      genderDisplay.textContent = gender;
      
      // 나이 계산 (만 나이)
      const year = parseInt(birth6.substring(0, 2));
      const month = parseInt(birth6.substring(2, 4));
      const day = parseInt(birth6.substring(4, 6));
      
      const currentDate = new Date();
      const currentYear = currentDate.getFullYear();
      const currentMonth = currentDate.getMonth() + 1;
      const currentDay = currentDate.getDate();
      
      // 2000년대 출생인지 1900년대 출생인지 판단
      const fullYear = year <= currentYear % 100 ? 2000 + year : 1900 + year;
      
      let age = currentYear - fullYear;
      if (currentMonth < month || (currentMonth === month && currentDay < day)) {
        age--;
      }
      
      ageDisplay.textContent = `만 ${age}세`;
    } else {
      genderDisplay.textContent = '';
      ageDisplay.textContent = '';
    }
  }
  
  // 폼 제출
  signupForm.addEventListener('submit', function(e) {
    e.preventDefault();
    
    // 닉네임 중복 체크 확인
    if (!nicknameChecked) {
      alert('닉네임 중복 체크를 해주세요.');
      return;
    }
    
    const name = document.getElementById('name').value;
    const username = document.getElementById('username').value;
    const nickname = document.getElementById('nickname').value;
    const email = document.getElementById('email').value;
    const birth6 = document.getElementById('birth6').value;
    const rrn1 = document.getElementById('rrn1').value;
    const password = document.getElementById('password').value;
    const confirmPassword = document.getElementById('confirmPassword').value;
    
    // 비밀번호 확인
    if (password !== confirmPassword) {
      alert('비밀번호가 일치하지 않습니다.');
      return;
    }
    
    // 기존 사용자 데이터 가져오기
    const users = JSON.parse(localStorage.getItem('users') || '[]');
    
    // 아이디 중복 체크
    const existingUser = users.find(user => user.username === username);
    if (existingUser) {
      alert('이미 존재하는 아이디입니다.');
      return;
    }
    
    // 새 사용자 데이터 생성
    const newUser = {
      id: Date.now(),
      name: name,
      username: username,
      nickname: nickname,
      email: email,
      birthYymmdd: birth6,
      gender: rrn1 === '1' ? '남성' : '여성',
      age: parseInt(ageDisplay.textContent.replace('만 ', '').replace('세', '')),
      password: password,
      requestDate: new Date().toISOString(),
      status: '요청중',
      approved: false,
      isAdmin: false
    };
    
    // 사용자 데이터 저장
    users.push(newUser);
    localStorage.setItem('users', JSON.stringify(users));
    
    alert('회원가입이 완료되었습니다.');
    
    // 로그인 페이지로 이동
    if (window.parent && window.parent.loadPage) {
      window.parent.loadPage('member/login.html');
    }
  });
});
</script>