<div class="container" style="max-width:600px; margin:auto; background:#fff; padding:30px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.1); font-family:'Segoe UI', sans-serif;">
  <h2 style="text-align:center; margin-bottom:20px;">✍️ 글 작성하기</h2>

  <form id="postForm">
    <label for="category" style="display:block; margin-bottom:6px; font-weight:bold;">유형</label>
    <select id="category" name="category" required style="width:100%; padding:8px; margin-bottom:15px; border:1px solid #ccc; border-radius:6px;">
      <option value="공지사항">공지사항</option>
      <option value="자유게시판" selected>자유게시판</option>
      <option value="회원요청">회원요청</option>
      <option value="기타">기타</option>
    </select>
    <label for="title" style="display:block; margin-bottom:6px; font-weight:bold;">제목</label>
    <input type="text" id="title" name="title" required style="width:100%; padding:8px; margin-bottom:15px; border:1px solid #ccc; border-radius:6px;">

    <label for="content" style="display:block; margin-bottom:6px; font-weight:bold;">내용</label>
    <textarea id="content" name="content" rows="10" required style="width:100%; padding:8px; border:1px solid #ccc; border-radius:6px;"></textarea>

    <div style="text-align:center; margin-top:20px;">
      <button type="submit" style="padding:10px 25px; background:#007bff; color:#fff; border:none; border-radius:8px; font-weight:bold; cursor:pointer;">저장</button>
      <button type="button" id="cancelBtn" style="padding:10px 25px; margin-left:10px; background:#6c757d; color:#fff; border:none; border-radius:8px; cursor:pointer;">취소</button>
    </div>
  </form>
</div>

<script>
  const loggedInUser = sessionStorage.getItem('loggedInUser');
  if (!loggedInUser) {
    alert('로그인 후 이용 가능합니다.');
    if (typeof loadPage === 'function') loadPage('member/login.html');
    else location.href = 'member/login.html';
  }

  const postForm = document.getElementById('postForm');
  const editPost = JSON.parse(sessionStorage.getItem('editPost') || 'null');

  // 글 수정 모드면 데이터 채우기
  if (editPost) {
    postForm.title.value = editPost.title;
    postForm.content.value = editPost.content;
    if (editPost.category) postForm.category.value = editPost.category;
  }

  postForm.addEventListener('submit', e => {
    e.preventDefault();

    const title = postForm.title.value.trim();
    const content = postForm.content.value.trim();

    if (!title || !content) {
      alert('제목과 내용을 모두 입력하세요.');
      return;
    }

    let posts = JSON.parse(localStorage.getItem('posts') || '[]');

    if (editPost) {
      // 수정
      posts = posts.map(p => {
        if (p.id === editPost.id) {
          return {
            ...p,
            title,
            content,
            category: postForm.category.value,
            updatedAt: new Date().toISOString()
          };
        }
        return p;
      });
      alert('글이 수정되었습니다.');
    } else {
      // 새 글 작성
      const newPost = {
        id: Date.now(),
        authorId: loggedInUser,
        authorName: (function(){
          const users = JSON.parse(localStorage.getItem('users')) || [];
          const me = users.find(u => u.username === loggedInUser);
          return me?.nickname || loggedInUser;
        })(),
        title,
        content,
        category: postForm.category.value,
        createdAt: new Date().toISOString(),
        updatedAt: null
      };
      posts.push(newPost);
      alert('글이 작성되었습니다.');
    }

    localStorage.setItem('posts', JSON.stringify(posts));
    sessionStorage.removeItem('editPost');

    if (typeof loadPage === 'function') {
      loadPage('board/list.html');
    } else {
      location.href = 'list.html';
    }
  });

  document.getElementById('cancelBtn').addEventListener('click', () => {
    sessionStorage.removeItem('editPost');
    if (typeof loadPage === 'function') {
      loadPage('board/list.html');
    } else {
      location.href = 'list.html';
    }
  });
</script>






