<div class="container" style="max-width:1200px; margin:auto; background:#fff; padding:20px 20px 70px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.06); font-family:'Segoe UI', sans-serif;">
  <h1 style="color:#333; margin:8px 0 14px; font-size:22px;">ğŸ“‹ ê²Œì‹œíŒ</h1>
  <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; margin-bottom:8px; flex-wrap:wrap;">
    <div style="display:flex; align-items:center; gap:8px;">
      <label for="catFilter" style="font-size:14px; color:#555;">ìœ í˜•</label>
      <select id="catFilter" style="padding:6px 10px; border:1px solid #dee2e6; border-radius:6px;">
        <option value="ì „ì²´">ì „ì²´</option>
        <option value="ê³µì§€ì‚¬í•­">ê³µì§€ì‚¬í•­</option>
        <option value="ììœ ê²Œì‹œíŒ">ììœ ê²Œì‹œíŒ</option>
        <option value="íšŒì›ìš”ì²­">íšŒì›ìš”ì²­</option>
        <option value="ê¸°íƒ€">ê¸°íƒ€</option>
      </select>
    </div>
    <div style="max-width:360px; display:flex; align-items:center; gap:8px; border:1px solid #e9ecef; border-radius:24px; padding:6px 12px; flex:1; min-width:240px;">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21 21l-4.35-4.35" stroke="#868e96" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><circle cx="10" cy="10" r="7" stroke="#868e96" stroke-width="2"/></svg>
      <input id="postSearch" type="text" placeholder="Search" style="flex:1; border:none; outline:none; font-size:14px; padding:6px;" />
      <button id="searchBtn" style="padding:6px 12px; background:linear-gradient(135deg, #007bff 0%, #0056b3 100%); color:#fff; border:none; border-radius:6px; cursor:pointer; font-size:12px; font-weight:500; transition:transform 0.2s ease, box-shadow 0.2s ease;" onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 3px 10px rgba(0, 123, 255, 0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">ê²€ìƒ‰</button>
    </div>
  </div>

  <div id="table_div" style="overflow:auto; border:1px solid #e9ecef; border-radius:10px;">
    <table style="width:100%; border-collapse:collapse; min-width:680px;">
      <thead>
        <tr style="background:#f8f9fa; color:#495057;">
          <th style="width:70px; padding:12px; border-bottom:1px solid #e9ecef; font-weight:600; text-align:center;">No</th>
          <th style="padding:12px; border-bottom:1px solid #e9ecef; font-weight:600; text-align:left;">ì œëª©</th>
          <th style="width:140px; padding:12px; border-bottom:1px solid #e9ecef; font-weight:600; text-align:center;">ê¸€ì“´ì´</th>
          <th style="width:160px; padding:12px; border-bottom:1px solid #e9ecef; font-weight:600; text-align:center;">ì‘ì„±ì‹œê°„</th>
          <th style="width:160px; padding:12px; border-bottom:1px solid #e9ecef; font-weight:600; text-align:center;">ìµœì¢… ìˆ˜ì •ì¼</th>
        </tr>
      </thead>
      <tbody id="postTableBody"></tbody>
    </table>
  </div>

  <button id="goToWrite" style="display:block; margin:16px 0 0 auto; padding:10px 16px; background:#343a40; color:#fff; border:none; border-radius:20px; cursor:pointer; box-shadow:0 2px 8px rgba(0,0,0,0.15);">ê¸€ì“°ê¸°</button>
</div>

<script>
  const loggedInUser = sessionStorage.getItem('loggedInUser');
  const users = JSON.parse(localStorage.getItem('users')) || [];
  const currentUser = users.find(u => u.username === loggedInUser);
  const isAdmin = currentUser?.isAdmin;

  function formatDate(isoString) {
    const date = new Date(isoString);
    return date.toLocaleString('ko-KR', {
      year: 'numeric', month: '2-digit', day: '2-digit',
      hour: '2-digit', minute: '2-digit'
    });
  }

  const PAGE_SIZE = 10;
  
  // ì „ì—­ ë³€ìˆ˜ ì‚¬ìš© (ì¤‘ë³µ ì„ ì–¸ ë°©ì§€)
  window.currentPage = window.currentPage || 1;
  window.currentCategory = window.currentCategory || 'ì „ì²´';
  window.lastSearch = window.lastSearch || '';
  
  const currentPage = window.currentPage;
  const currentCategory = window.currentCategory;
  const lastSearch = window.lastSearch;

  function renderPagination(total) {
    let pager = document.getElementById('postPager');
    if (!pager) {
      pager = document.createElement('div');
      pager.id = 'postPager';
      pager.style.display = 'flex';
      pager.style.gap = '6px';
      pager.style.justifyContent = 'center';
      pager.style.alignItems = 'center';
      pager.style.margin = '12px auto 0';
      const container = document.querySelector('.container');
      container.appendChild(pager);
    }
    pager.innerHTML = '';
    const totalPages = Math.max(1, Math.ceil(total / PAGE_SIZE));
    const makeBtn = (label, page, disabled, active) => {
      const b = document.createElement('button');
      b.textContent = label;
      b.style.padding = '8px 12px';
      b.style.border = 'none';
      b.style.borderRadius = '8px';
      b.style.fontWeight = '500';
      b.style.cursor = 'pointer';
      b.style.transition = 'all 0.2s ease';
      b.disabled = !!disabled;
      
      if (active) {
        // í™œì„± í˜ì´ì§€ ë²„íŠ¼ (ê·¸ë¼ë°ì´ì…˜)
        b.style.background = 'linear-gradient(135deg, #007bff 0%, #0056b3 100%)';
        b.style.color = '#fff';
        b.style.boxShadow = '0 2px 8px rgba(0, 123, 255, 0.3)';
      } else if (disabled) {
        // ë¹„í™œì„± ë²„íŠ¼
        b.style.background = '#f8f9fa';
        b.style.color = '#6c757d';
        b.style.cursor = 'not-allowed';
        b.style.opacity = '0.6';
      } else {
        // ì¼ë°˜ ë²„íŠ¼ (í˜¸ë²„ íš¨ê³¼ í¬í•¨)
        b.style.background = '#fff';
        b.style.color = '#495057';
        b.style.border = '1px solid #e9ecef';
        
        b.addEventListener('mouseenter', () => {
          b.style.background = 'linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%)';
          b.style.transform = 'translateY(-1px)';
          b.style.boxShadow = '0 2px 8px rgba(0, 0, 0, 0.1)';
        });
        
        b.addEventListener('mouseleave', () => {
          b.style.background = '#fff';
          b.style.transform = 'translateY(0)';
          b.style.boxShadow = 'none';
        });
      }
      
      b.addEventListener('click', () => { 
        window.currentPage = page; 
        loadPosts(window.lastSearch); 
      });
      return b;
    };
    pager.appendChild(makeBtn('ì´ì „', Math.max(1, currentPage - 1), currentPage === 1, false));
    for (let p = 1; p <= totalPages; p++) pager.appendChild(makeBtn(String(p), p, false, p === currentPage));
    pager.appendChild(makeBtn('ë‹¤ìŒ', Math.min(totalPages, currentPage + 1), currentPage === totalPages, false));
  }


  function loadPosts(filterText = '') {
    const tbody = document.getElementById('postTableBody');
    const posts = JSON.parse(localStorage.getItem('posts') || '[]');
    window.lastSearch = filterText || '';
    const keyword = String(window.lastSearch).toLowerCase();
    const filtered = keyword
      ? posts.filter(p => {
          const title = (p.title || '').toLowerCase();
          const content = (p.content || '').toLowerCase();
          const author = (p.authorName || p.author || p.authorId || '').toLowerCase();
          return title.includes(keyword) || content.includes(keyword) || author.includes(keyword);
        })
      : posts;

    const filteredByCat = (window.currentCategory === 'ì „ì²´') ? filtered : filtered.filter(p => (p.category || 'ê¸°íƒ€') === window.currentCategory);

    tbody.innerHTML = '';

    // ìµœê·¼ ì‘ì„±ê¸€ì´ ìœ„ë¡œ ì˜¤ë„ë¡ ì •ë ¬
    const sorted = [...filteredByCat].sort((a, b) => {
      const at = a.createdAt ? new Date(a.createdAt).getTime() : 0;
      const bt = b.createdAt ? new Date(b.createdAt).getTime() : 0;
      return bt - at;
    });

    const start = (window.currentPage - 1) * PAGE_SIZE;
    const end = start + PAGE_SIZE;
    const pageItems = sorted.slice(start, end);

    pageItems.forEach((post, idx) => {
      const tr = document.createElement('tr');
      tr.style.borderBottom = '1px solid #f1f3f5';

      const noTd = document.createElement('td');
      noTd.style.textAlign = 'center';
      noTd.style.padding = '12px';
      noTd.textContent = String(start + idx + 1);

      const titleTd = document.createElement('td');

       titleTd.style.textAlign = 'left';
      titleTd.style.padding = '12px';
      titleTd.style.cursor = 'pointer';
      titleTd.style.color = '#212529';
      const cat = post.category || 'ê¸°íƒ€';
      const catBadge = `<span style="display:inline-block; margin-right:6px; padding:2px 6px; border-radius:10px; background:#e9ecef; font-size:11px; color:#495057; vertical-align:middle;">${cat}</span>`;
      
      // ê²€ìƒ‰ì–´ í•˜ì´ë¼ì´íŠ¸ í•¨ìˆ˜
      function highlightText(text, keyword) {
        if (!keyword) return text;
        const regex = new RegExp(`(${keyword})`, 'gi');
        return text.replace(regex, '<mark style="background:#ffeb3b; padding:2px 4px; border-radius:3px;">$1</mark>');
      }
      
      const highlightedTitle = highlightText(post.title, window.lastSearch);
      titleTd.innerHTML = `${catBadge}<span class="post-title" data-id="${post.id}">${highlightedTitle}</span>`;

      const authorTd = document.createElement('td');
      authorTd.style.textAlign = 'center';
      authorTd.style.padding = '12px';
      const authorName = post.authorName || post.author || post.authorId || '';
      authorTd.innerHTML = highlightText(authorName, window.lastSearch);

      const dateTd = document.createElement('td');
      dateTd.style.textAlign = 'center';
      dateTd.style.padding = '12px';
      dateTd.style.whiteSpace = 'nowrap';
      dateTd.style.fontSize = '13px';
      dateTd.textContent = post.createdAt ? formatDate(post.createdAt) : '';

      const updateTd = document.createElement('td');
      updateTd.style.textAlign = 'center';
      updateTd.style.padding = '12px';
      updateTd.style.whiteSpace = 'nowrap';
      updateTd.style.fontSize = '13px';
      updateTd.textContent = post.updatedAt ? formatDate(post.updatedAt) : '-';

      tr.appendChild(noTd);
      tr.appendChild(titleTd);
      tr.appendChild(authorTd);
      tr.appendChild(dateTd);
      tr.appendChild(updateTd);
      tbody.appendChild(tr);

      // ë‚´ìš© í–‰ (í† ê¸€)
      const contentTr = document.createElement('tr');
      const contentTd = document.createElement('td');
      contentTd.colSpan = 5;
      contentTd.style.background = 'linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%)';
      contentTd.style.padding = '24px';
      contentTd.style.display = 'none';
      contentTd.style.position = 'relative';
      
      const highlightedContent = highlightText(post.content, window.lastSearch);
      contentTd.innerHTML = `
        <div style="
          background: white;
          border-radius: 12px;
          padding: 20px;
          box-shadow: 0 2px 8px rgba(0,0,0,0.1);
          border: 1px solid #e0e0e0;
          margin-bottom: 16px;
        ">
          <div style="
            color: #2c3e50;
            line-height: 1.8;
            white-space: pre-wrap;
            font-size: 15px;
            text-align: left;
            word-break: break-word;
          ">
            ${highlightedContent}
          </div>
        </div>

        ${((loggedInUser === (post.authorId || post.author)) || isAdmin) ? `
          <div style="text-align: right; margin-top: 8px;">
            <button class="edit-btn" data-id="${post.id}" style="
              margin-right: 8px; 
              padding: 8px 16px; 
              background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%); 
              color: white; 
              border: none; 
              border-radius: 8px; 
              cursor: pointer;
              font-weight: 500;
              transition: transform 0.2s ease, box-shadow 0.2s ease;
            " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(108, 117, 125, 0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">ìˆ˜ì •</button>
            <button class="delete-btn" data-id="${post.id}" style="
              padding: 8px 16px; 
              background: linear-gradient(135deg, #495057 0%, #343a40 100%); 
              color: white; 
              border: none; 
              border-radius: 8px; 
              cursor: pointer;
              font-weight: 500;
              transition: transform 0.2s ease, box-shadow 0.2s ease;
            " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(73, 80, 87, 0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">ì‚­ì œ</button>
          </div>
        ` : ''}
      `;
      contentTr.appendChild(contentTd);
      tbody.appendChild(contentTr);

      titleTd.addEventListener('click', () => {
        const isHidden = contentTd.style.display === 'none';
        
        if (isHidden) {
          // í¼ì¹˜ê¸° ì• ë‹ˆë©”ì´ì…˜
          contentTd.style.display = 'table-cell';
          contentTd.style.opacity = '0';
          contentTd.style.transform = 'translateY(-10px)';
          
          setTimeout(() => {
            contentTd.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
            contentTd.style.opacity = '1';
            contentTd.style.transform = 'translateY(0)';
          }, 10);
        } else {
          // ì ‘ê¸° ì• ë‹ˆë©”ì´ì…˜
          contentTd.style.transition = 'opacity 0.2s ease, transform 0.2s ease';
          contentTd.style.opacity = '0';
          contentTd.style.transform = 'translateY(-10px)';
          
          setTimeout(() => {
            contentTd.style.display = 'none';
          }, 200);
        }
      });
    });

    // ì œëª© í´ë¦­ ì‹œ ë‚´ìš© í† ê¸€
    document.querySelectorAll('.post-title').forEach(title => {
      title.addEventListener('click', () => {
        const content = title.parentElement.querySelector('.post-content');
        const actions = title.parentElement.querySelector('.post-actions');
        const isVisible = content.style.display === 'block';
        content.style.display = isVisible ? 'none' : 'block';
        actions.style.display = isVisible ? 'none' : 'block';
      });
    });

    // ì‚­ì œ
    document.querySelectorAll('.delete-btn').forEach(button => {
      button.addEventListener('click', () => {
        if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
        const id = parseInt(button.getAttribute('data-id'));
        let posts = JSON.parse(localStorage.getItem('posts') || '[]');
        posts = posts.filter(p => p.id !== id);
        localStorage.setItem('posts', JSON.stringify(posts));
        alert('ê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        loadPosts();
      });
    });

    // ìˆ˜ì •
    document.querySelectorAll('.edit-btn').forEach(button => {
      button.addEventListener('click', () => {
        const id = parseInt(button.getAttribute('data-id'));
        const posts = JSON.parse(localStorage.getItem('posts') || '[]');
        const post = posts.find(p => p.id === id);
        if (!post) return;
        sessionStorage.setItem('editPost', JSON.stringify(post));
        if (typeof loadPage === 'function') {
          loadPage('board/write.html');
        } else {
          alert('ì‘ì„± í˜ì´ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
      });
    });

    attachWriteBtnListener();
    renderPagination(sorted.length);
  }

  function attachWriteBtnListener() {
    const goToWriteBtn = document.getElementById('goToWrite');
    if (!goToWriteBtn) return;

    goToWriteBtn.onclick = null;

    goToWriteBtn.addEventListener('click', () => {
      const loggedInUser = sessionStorage.getItem('loggedInUser');
      
      if (!loggedInUser) {
        alert('ë¡œê·¸ì¸ í›„ ê¸€ ì‘ì„±ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
        if (typeof loadPage === 'function') loadPage('member/login.html');
        else location.href = 'member/login.html';
        return;
      }
      sessionStorage.removeItem('editPost');
      if (typeof loadPage === 'function') loadPage('board/write.html');
      else location.href = 'board/write.html';
    });
  }

  // ê²€ìƒ‰ ë°”ì¸ë”©
  const searchInput = document.getElementById('postSearch');
  const searchBtn = document.getElementById('searchBtn');
  
  function performSearch() {
    window.lastSearch = searchInput.value.trim(); // ê²€ìƒ‰ì–´ ì €ì¥
    window.currentPage = 1;
    loadPosts(searchInput.value);
  }
  
  if (searchInput) {
    searchInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') performSearch();
    });
  }
  
  if (searchBtn) {
    searchBtn.addEventListener('click', performSearch);
  }

  const catFilter = document.getElementById('catFilter');
  if (catFilter) {
    catFilter.addEventListener('change', () => {
      window.currentCategory = catFilter.value;
      window.currentPage = 1;
      loadPosts(window.lastSearch);
    });
  }

  // ì´ˆê¸° ë¡œë“œ
  loadPosts('');

</script>













